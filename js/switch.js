// koffee 1.3.0
var $, activate, activeApp, apps, childp, clamp, done, drag, electron, elem, empty, getApps, highlight, initWin, karg, keyinfo, klog, kpos, last, loadApps, nextApp, onKeyDown, onKeyUp, onMouseDown, onMouseMove, pngPath, post, prefs, prevApp, quitApp, ref, slash, start, wc, winRect,
    indexOf = [].indexOf;

ref = require('kxk'), childp = ref.childp, post = ref.post, karg = ref.karg, slash = ref.slash, drag = ref.drag, elem = ref.elem, prefs = ref.prefs, clamp = ref.clamp, kpos = ref.kpos, empty = ref.empty, last = ref.last, klog = ref.klog, keyinfo = ref.keyinfo, $ = ref.$;

wc = require('./wc');

electron = require('electron');

apps = [];

getApps = function() {
    var file, i, info, infos, len, name, ref1, ref2;
    infos = wc('info');
    apps = [];
    for (i = 0, len = infos.length; i < len; i++) {
        info = infos[i];
        if (info.title === 'wxw-switch') {
            continue;
        }
        if (info.path.endsWith('ImmersiveControlPanel\SystemSettings.exe')) {
            continue;
        }
        if (info.path.indexOf('\\WindowsApps\\') >= 0) {
            continue;
        }
        file = slash.file(info.path);
        if (file === 'ApplicationFrameHost.exe') {
            name = last(info.title.split(' ?- '));
            if (name === 'Calendar' || name === 'Mail') {
                if (indexOf.call(apps, name) < 0) {
                    apps.push(name);
                }
            } else if ((ref1 = info.title) === 'Settings' || ref1 === 'Calculator' || ref1 === 'Microsoft Store') {
                apps.push(info.title);
            }
        } else {
            if (ref2 = info.path, indexOf.call(apps, ref2) < 0) {
                apps.push(info.path);
            }
        }
    }
    return apps;
};

pngPath = function(appPath) {
    var pth;
    pth = slash.resolve(slash.join(slash.userData(), 'icons', slash.base(appPath) + ".png"));
    klog(pth);
    return pth;
};

winRect = function(numApps) {
    var as, border, height, ss, width;
    ss = electron.screen.getPrimaryDisplay().workAreaSize;
    as = 128;
    border = 20;
    width = (as + border) * apps.length + border;
    height = as + border * 2;
    return {
        x: parseInt((ss.width - width) / 2),
        y: parseInt((ss.height - height) / 2),
        width: width,
        height: height
    };
};

start = function(opt) {
    var app, data, html, i, len, png, win, wr;
    if (opt == null) {
        opt = {};
    }
    apps = getApps();
    for (i = 0, len = apps.length; i < len; i++) {
        app = apps[i];
        png = pngPath(slash.base(app));
        if (!slash.fileExists(png)) {
            wc('icon', app, png);
        }
    }
    wr = winRect(apps.length);
    win = new electron.BrowserWindow({
        backgroundColor: '#00000000',
        transparent: true,
        preloadWindow: true,
        x: wr.x,
        y: wr.y,
        width: wr.width,
        height: wr.height,
        hasShadow: false,
        resizable: false,
        frame: false,
        thickFrame: false,
        fullscreen: false,
        show: true,
        webPreferences: {
            nodeIntegration: true,
            webSecurity: false
        }
    });
    html = "<head>\n<title>wxw-switch</title>\n<style type=\"text/css\">\n    * {\n        outline-width:  0;\n    }\n    \n    body {\n        overflow:       hidden;\n        margin:         0;\n    }\n    .apps {\n        opacity:        1;\n        white-space:    nowrap;\n        position:       absolute;\n        left:           0px;\n        top:            0px;\n        bottom:         0px;\n        right:          0px;\n        overflow:       hidden;\n        background:     rgb(16,16,16);\n        border-radius:  6px;\n        padding:        10px;\n    }\n    .app {\n        display:        inline-block;\n        width:          128px;\n        height:         128px;\n        padding:        10px;\n    }            \n    .app:hover {\n        background:     rgb(20,20,20);\n    }\n    .app.highlight {\n        background:     rgb(24,24,24);\n    }\n</style>\n</head>\n<body>\n<div class=\"apps\" tabindex=0></div>\n<script>\n    var pth = process.resourcesPath + \"/app/js/switch.js\";\n    if (process.resourcesPath.indexOf(\"node_modules\\\\electron\\\\dist\\\\resources\")>=0) { pth = process.cwd() + \"/js/switch.js\"; }\n    console.log(pth, process.resourcesPath);\n    require(pth).initWin();\n</script>\n</body>";
    data = "data:text/html;charset=utf-8," + encodeURI(html);
    win.loadURL(data, {
        baseURLForDataURL: slash.fileUrl(__dirname + '/index.html')
    });
    win.debug = opt.debug;
    if (opt.debug) {
        win.webContents.openDevTools();
    }
    return win;
};

done = function() {
    return electron.remote.getCurrentWindow().hide();
};

activeApp = null;

activate = function() {
    var i, info, infos, j, len, len1, ref1, ref2;
    done();
    if (activeApp.id) {
        if ((ref1 = activeApp.id) === 'Mail' || ref1 === 'Calendar') {
            infos = wc('info', 'ApplicationFrameHost.exe');
            for (i = 0, len = infos.length; i < len; i++) {
                info = infos[i];
                if (info.title.endsWith(activeApp.id)) {
                    wc('focus', info.hwnd);
                    return;
                }
            }
            return childp.spawn('start', [
                {
                    Mail: 'outlookmail:',
                    Calendar: 'outlookcal:'
                }[activeApp.id]
            ], {
                encoding: 'utf8',
                shell: true,
                detached: true,
                stdio: 'inherit'
            });
        } else if ((ref2 = activeApp.id) === 'Calculator' || ref2 === 'Settings' || ref2 === 'Microsoft Store') {
            infos = wc('info', 'ApplicationFrameHost.exe');
            for (j = 0, len1 = infos.length; j < len1; j++) {
                info = infos[j];
                if (info.title === activeApp.id) {
                    wc('focus', info.hwnd);
                    return;
                }
            }
            return childp.spawn('start', [
                {
                    Calculator: 'calculator:',
                    Settings: 'ms-settings:',
                    'Microsoft Store': 'ms-windows-store:'
                }[activeApp.id]
            ], {
                encoding: 'utf8',
                shell: true,
                detached: true,
                stdio: 'inherit'
            });
        } else {
            return wc('focus', activeApp.id);
        }
    }
};

highlight = function(e) {
    if (e.id) {
        if (activeApp != null) {
            activeApp.classList.remove('highlight');
        }
        e.classList.add('highlight');
        return activeApp = e;
    }
};

nextApp = function() {
    var ref1;
    return highlight((ref1 = activeApp.nextSibling) != null ? ref1 : $('.apps').firstChild);
};

prevApp = function() {
    var ref1;
    return highlight((ref1 = activeApp.previousSibling) != null ? ref1 : $('.apps').lastChild);
};

quitApp = function() {
    return klog('quitApp', activeApp.id);
};

onMouseMove = function(event) {
    return highlight(event.target);
};

onMouseDown = function(event) {
    activeApp = event.target;
    return activate();
};

onKeyDown = function(event) {
    var char, combo, key, mod, ref1;
    ref1 = keyinfo.forEvent(event), mod = ref1.mod, key = ref1.key, char = ref1.char, combo = ref1.combo;
    switch (key) {
        case 'esc':
            done();
            break;
        case 'right':
            nextApp();
            break;
        case 'left':
            prevApp();
            break;
        case 'q':
            quitApp();
            break;
        case 'enter':
        case 'return':
        case 'space':
            activate();
            break;
        default:
            klog('onKeyDown', combo);
    }
    switch (combo) {
        case 'ctrl+shift+tab':
            return prevApp();
        case 'alt+ctrl+q':
            return electron.remote.app.quit();
    }
};

onKeyUp = function(event) {
    var char, combo, key, mod, ref1;
    ref1 = keyinfo.forEvent(event), mod = ref1.mod, key = ref1.key, char = ref1.char, combo = ref1.combo;
    if (empty(combo)) {
        return activate();
    }
};

initWin = function() {
    var a, win;
    win = electron.remote.getCurrentWindow();
    a = $('.apps');
    a.onmousedown = onMouseDown;
    a.onkeydown = onKeyDown;
    a.onkeyup = onKeyUp;
    loadApps();
    return post.on('nextApp', function() {
        var restore;
        if (win.isVisible()) {
            return nextApp();
        } else {
            win.setPosition(-10000, -10000);
            win.show();
            a = $('.apps');
            a.innerHTML = '';
            restore = function() {
                var wr;
                wr = winRect(apps.length);
                return win.setBounds(wr);
            };
            setTimeout(restore, 30);
            return loadApps();
        }
    });
};

loadApps = function() {
    var a, i, len, p, ref1, ref2;
    a = $('.apps');
    a.innerHTML = '';
    ref1 = getApps();
    for (i = 0, len = ref1.length; i < len; i++) {
        p = ref1[i];
        a.appendChild(elem('img', {
            id: p,
            "class": 'app',
            src: slash.fileUrl(pngPath(p))
        }));
    }
    a.focus();
    return highlight((ref2 = a.firstChild.nextSibling) != null ? ref2 : a.firstChild);
};

module.exports = {
    start: start,
    initWin: initWin
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3dpdGNoLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBTUEsSUFBQSxxUkFBQTtJQUFBOztBQUFBLE1BQStGLE9BQUEsQ0FBUSxLQUFSLENBQS9GLEVBQUUsbUJBQUYsRUFBVSxlQUFWLEVBQWdCLGVBQWhCLEVBQXNCLGlCQUF0QixFQUE2QixlQUE3QixFQUFtQyxlQUFuQyxFQUF5QyxpQkFBekMsRUFBZ0QsaUJBQWhELEVBQXVELGVBQXZELEVBQTZELGlCQUE3RCxFQUFvRSxlQUFwRSxFQUEwRSxlQUExRSxFQUFnRixxQkFBaEYsRUFBeUY7O0FBRXpGLEVBQUEsR0FBSyxPQUFBLENBQVEsTUFBUjs7QUFDTCxRQUFBLEdBQVcsT0FBQSxDQUFRLFVBQVI7O0FBUVgsSUFBQSxHQUFPOztBQUNQLE9BQUEsR0FBVSxTQUFBO0FBRU4sUUFBQTtJQUFBLEtBQUEsR0FBUSxFQUFBLENBQUcsTUFBSDtJQUVSLElBQUEsR0FBTztBQUNQLFNBQUEsdUNBQUE7O1FBQ0ksSUFBWSxJQUFJLENBQUMsS0FBTCxLQUFjLFlBQTFCO0FBQUEscUJBQUE7O1FBQ0EsSUFBWSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVYsQ0FBbUIsMENBQW5CLENBQVo7QUFBQSxxQkFBQTs7UUFHQSxJQUFZLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBVixDQUFrQixpQkFBbEIsQ0FBQSxJQUF3QyxDQUFwRDtBQUFBLHFCQUFBOztRQUNBLElBQUEsR0FBTyxLQUFLLENBQUMsSUFBTixDQUFXLElBQUksQ0FBQyxJQUFoQjtRQUNQLElBQUcsSUFBQSxLQUFRLDBCQUFYO1lBQ0ksSUFBQSxHQUFPLElBQUEsQ0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQVgsQ0FBaUIsTUFBakIsQ0FBTDtZQUNQLElBQUcsSUFBQSxLQUFTLFVBQVQsSUFBQSxJQUFBLEtBQW9CLE1BQXZCO2dCQUNJLElBQWtCLGFBQVksSUFBWixFQUFBLElBQUEsS0FBbEI7b0JB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O0lBQUEsS0FBQSxFQUFNLEtBQU47SUFDQSxPQUFBLEVBQVEsT0FEUiIsInNvdXJjZXNDb250ZW50IjpbIiMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwMDAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgIFxuIyAwMDAgICAgICAgMDAwIDAgMDAwICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4jIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgMDAwMDAwMDAwICBcbiMgICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIFxuIyAwMDAwMDAwICAgMDAgICAgIDAwICAwMDAgICAgIDAwMCAgICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgXG5cbnsgY2hpbGRwLCBwb3N0LCBrYXJnLCBzbGFzaCwgZHJhZywgZWxlbSwgcHJlZnMsIGNsYW1wLCBrcG9zLCBlbXB0eSwgbGFzdCwga2xvZywga2V5aW5mbywgJCB9ID0gcmVxdWlyZSAna3hrJ1xuXG53YyA9IHJlcXVpcmUgJy4vd2MnXG5lbGVjdHJvbiA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xuXG4jICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAwMCAgICAgICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMDAgICAgMDAwMDAwMCAgXG4jIDAwMCAgICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgXG4jIDAwMCAgMDAwMCAgMDAwMDAwMCAgICAgIDAwMCAgICAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAgXG4jIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgICAgICAgIDAwMCAgXG4jICAwMDAwMDAwICAgMDAwMDAwMDAgICAgIDAwMCAgICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgICAwMDAwMDAwICAgXG5cbmFwcHMgPSBbXVxuZ2V0QXBwcyA9IC0+XG5cbiAgICBpbmZvcyA9IHdjICdpbmZvJ1xuICAgIFxuICAgIGFwcHMgPSBbXVxuICAgIGZvciBpbmZvIGluIGluZm9zXG4gICAgICAgIGNvbnRpbnVlIGlmIGluZm8udGl0bGUgPT0gJ3d4dy1zd2l0Y2gnXG4gICAgICAgIGNvbnRpbnVlIGlmIGluZm8ucGF0aC5lbmRzV2l0aCAnSW1tZXJzaXZlQ29udHJvbFBhbmVsXFxTeXN0ZW1TZXR0aW5ncy5leGUnXG4gICAgICAgICMgY29udGludWUgaWYgaW5mby5wYXRoLmluZGV4T2YoJ1xcXFxXaW5kb3dzQXBwc1xcXFxtaWNyb3NvZnQud2luZG93c2NvbW11bmljYXRpb25zYXBwcycpID49IDBcbiAgICAgICAgIyBjb250aW51ZSBpZiBpbmZvLnBhdGguaW5kZXhPZignXFxcXFdpbmRvd3NBcHBzXFxcXE1pY3Jvc29mdC5XaW5kb3dzQWxhcm1zJykgPj0gMFxuICAgICAgICBjb250aW51ZSBpZiBpbmZvLnBhdGguaW5kZXhPZignXFxcXFdpbmRvd3NBcHBzXFxcXCcpID49IDBcbiAgICAgICAgZmlsZSA9IHNsYXNoLmZpbGUgaW5mby5wYXRoXG4gICAgICAgIGlmIGZpbGUgPT0gJ0FwcGxpY2F0aW9uRnJhbWVIb3N0LmV4ZSdcbiAgICAgICAgICAgIG5hbWUgPSBsYXN0IGluZm8udGl0bGUuc3BsaXQgJyA/LSAnXG4gICAgICAgICAgICBpZiBuYW1lIGluIFsnQ2FsZW5kYXInICdNYWlsJ11cbiAgICAgICAgICAgICAgICBhcHBzLnB1c2ggbmFtZSBpZiBuYW1lIG5vdCBpbiBhcHBzXG4gICAgICAgICAgICBlbHNlIGlmIGluZm8udGl0bGUgaW4gWydTZXR0aW5ncycgJ0NhbGN1bGF0b3InICdNaWNyb3NvZnQgU3RvcmUnXVxuICAgICAgICAgICAgICAgIGFwcHMucHVzaCBpbmZvLnRpdGxlXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGFwcHMucHVzaCBpbmZvLnBhdGggaWYgaW5mby5wYXRoIG5vdCBpbiBhcHBzXG4gICAgYXBwc1xuICAgIFxuIyAwMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICBcbiMgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgICAgXG4jIDAwMDAwMDAwICAgMDAwIDAgMDAwICAwMDAgIDAwMDAgIFxuIyAwMDAgICAgICAgIDAwMCAgMDAwMCAgMDAwICAgMDAwICBcbiMgMDAwICAgICAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgXG5cbnBuZ1BhdGggPSAoYXBwUGF0aCkgLT5cbiAgICAjIGtsb2cgJ2FwcFBhdGgnIGFwcFBhdGgsIHNsYXNoLmJhc2UoYXBwUGF0aClcbiAgICBwdGggPSBzbGFzaC5yZXNvbHZlIHNsYXNoLmpvaW4gc2xhc2gudXNlckRhdGEoKSwgJ2ljb25zJywgc2xhc2guYmFzZShhcHBQYXRoKSArIFwiLnBuZ1wiXG4gICAga2xvZyBwdGhcbiAgICBwdGhcbiAgICBcbiMgIDAwMDAwMDAgIDAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAwMCAgXG4jIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuIyAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAgICAgMDAwICAgICBcbiMgICAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4jIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuXG53aW5SZWN0ID0gKG51bUFwcHMpIC0+XG4gICAgXG4gICAgc3MgPSBlbGVjdHJvbi5zY3JlZW4uZ2V0UHJpbWFyeURpc3BsYXkoKS53b3JrQXJlYVNpemVcbiAgICBhcyA9IDEyOFxuICAgIGJvcmRlciA9IDIwXG4gICAgd2lkdGggPSAoYXMrYm9yZGVyKSphcHBzLmxlbmd0aCtib3JkZXJcbiAgICBoZWlnaHQgPSBhcytib3JkZXIqMlxuICAgIFxuICAgIHg6cGFyc2VJbnQgKHNzLndpZHRoLXdpZHRoKS8yXG4gICAgeTpwYXJzZUludCAoc3MuaGVpZ2h0LWhlaWdodCkvMlxuICAgIHdpZHRoOndpZHRoXG4gICAgaGVpZ2h0OmhlaWdodFxuXG5zdGFydCA9IChvcHQ9e30pIC0+IFxuICAgIFxuICAgIGFwcHMgPSBnZXRBcHBzKClcbiAgICBcbiAgICBmb3IgYXBwIGluIGFwcHNcbiAgICAgICAgcG5nID0gcG5nUGF0aCBzbGFzaC5iYXNlIGFwcFxuICAgICAgICBpZiBub3Qgc2xhc2guZmlsZUV4aXN0cyBwbmdcbiAgICAgICAgICAgICMga2xvZyAnaWNvbicgYXBwLCBwbmdcbiAgICAgICAgICAgIHdjICdpY29uJyBhcHAsIHBuZ1xuICAgICAgICBcbiAgICB3ciA9IHdpblJlY3QgYXBwcy5sZW5ndGhcbiAgICAgICAgICAgIFxuICAgIHdpbiA9IG5ldyBlbGVjdHJvbi5Ccm93c2VyV2luZG93XG5cbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzAwMDAwMDAwJ1xuICAgICAgICB0cmFuc3BhcmVudDogICAgIHRydWVcbiAgICAgICAgcHJlbG9hZFdpbmRvdzogICB0cnVlXG4gICAgICAgIHg6ICAgICAgICAgICAgICAgd3IueFxuICAgICAgICB5OiAgICAgICAgICAgICAgIHdyLnlcbiAgICAgICAgd2lkdGg6ICAgICAgICAgICB3ci53aWR0aFxuICAgICAgICBoZWlnaHQ6ICAgICAgICAgIHdyLmhlaWdodFxuICAgICAgICBoYXNTaGFkb3c6ICAgICAgIGZhbHNlXG4gICAgICAgIHJlc2l6YWJsZTogICAgICAgZmFsc2VcbiAgICAgICAgZnJhbWU6ICAgICAgICAgICBmYWxzZVxuICAgICAgICB0aGlja0ZyYW1lOiAgICAgIGZhbHNlXG4gICAgICAgIGZ1bGxzY3JlZW46ICAgICAgZmFsc2VcbiAgICAgICAgc2hvdzogICAgICAgICAgICB0cnVlXG4gICAgICAgIHdlYlByZWZlcmVuY2VzOlxuICAgICAgICAgICAgbm9kZUludGVncmF0aW9uOiB0cnVlXG4gICAgICAgICAgICB3ZWJTZWN1cml0eTogICAgIGZhbHNlXG4gICAgICAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMCAgICAgMDAgIDAwMCAgICAgIFxuICAgICMgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgXG4gICAgIyAwMDAwMDAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDAwICAwMDAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgMCAwMDAgIDAwMCAgICAgIFxuICAgICMgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgXG4gICAgXG4gICAgaHRtbCA9IFwiXCJcIlxuICAgICAgICA8aGVhZD5cbiAgICAgICAgPHRpdGxlPnd4dy1zd2l0Y2g8L3RpdGxlPlxuICAgICAgICA8c3R5bGUgdHlwZT1cInRleHQvY3NzXCI+XG4gICAgICAgICAgICAqIHtcbiAgICAgICAgICAgICAgICBvdXRsaW5lLXdpZHRoOiAgMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYm9keSB7XG4gICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICAgICAgIGhpZGRlbjtcbiAgICAgICAgICAgICAgICBtYXJnaW46ICAgICAgICAgMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC5hcHBzIHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAgICAgICAgMTtcbiAgICAgICAgICAgICAgICB3aGl0ZS1zcGFjZTogICAgbm93cmFwO1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAgICAgICBhYnNvbHV0ZTtcbiAgICAgICAgICAgICAgICBsZWZ0OiAgICAgICAgICAgMHB4O1xuICAgICAgICAgICAgICAgIHRvcDogICAgICAgICAgICAwcHg7XG4gICAgICAgICAgICAgICAgYm90dG9tOiAgICAgICAgIDBweDtcbiAgICAgICAgICAgICAgICByaWdodDogICAgICAgICAgMHB4O1xuICAgICAgICAgICAgICAgIG92ZXJmbG93OiAgICAgICBoaWRkZW47XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogICAgIHJnYigxNiwxNiwxNik7XG4gICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogIDZweDtcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiAgICAgICAgMTBweDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC5hcHAge1xuICAgICAgICAgICAgICAgIGRpc3BsYXk6ICAgICAgICBpbmxpbmUtYmxvY2s7XG4gICAgICAgICAgICAgICAgd2lkdGg6ICAgICAgICAgIDEyOHB4O1xuICAgICAgICAgICAgICAgIGhlaWdodDogICAgICAgICAxMjhweDtcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiAgICAgICAgMTBweDtcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcbiAgICAgICAgICAgIC5hcHA6aG92ZXIge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICAgICByZ2IoMjAsMjAsMjApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLmFwcC5oaWdobGlnaHQge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICAgICByZ2IoMjQsMjQsMjQpO1xuICAgICAgICAgICAgfVxuICAgICAgICA8L3N0eWxlPlxuICAgICAgICA8L2hlYWQ+XG4gICAgICAgIDxib2R5PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYXBwc1wiIHRhYmluZGV4PTA+PC9kaXY+XG4gICAgICAgIDxzY3JpcHQ+XG4gICAgICAgICAgICB2YXIgcHRoID0gcHJvY2Vzcy5yZXNvdXJjZXNQYXRoICsgXCIvYXBwL2pzL3N3aXRjaC5qc1wiO1xuICAgICAgICAgICAgaWYgKHByb2Nlc3MucmVzb3VyY2VzUGF0aC5pbmRleE9mKFwibm9kZV9tb2R1bGVzXFxcXFxcXFxlbGVjdHJvblxcXFxcXFxcZGlzdFxcXFxcXFxccmVzb3VyY2VzXCIpPj0wKSB7IHB0aCA9IHByb2Nlc3MuY3dkKCkgKyBcIi9qcy9zd2l0Y2guanNcIjsgfVxuICAgICAgICAgICAgY29uc29sZS5sb2cocHRoLCBwcm9jZXNzLnJlc291cmNlc1BhdGgpO1xuICAgICAgICAgICAgcmVxdWlyZShwdGgpLmluaXRXaW4oKTtcbiAgICAgICAgPC9zY3JpcHQ+XG4gICAgICAgIDwvYm9keT5cbiAgICBcIlwiXCJcblxuICAgIGRhdGEgPSBcImRhdGE6dGV4dC9odG1sO2NoYXJzZXQ9dXRmLTgsXCIgKyBlbmNvZGVVUkkoaHRtbClcbiAgICB3aW4ubG9hZFVSTCBkYXRhLCBiYXNlVVJMRm9yRGF0YVVSTDpzbGFzaC5maWxlVXJsIF9fZGlybmFtZSArICcvaW5kZXguaHRtbCdcblxuICAgIHdpbi5kZWJ1ZyA9IG9wdC5kZWJ1Z1xuICAgIFxuICAgIGlmIG9wdC5kZWJ1Z1xuICAgICAgICB3aW4ud2ViQ29udGVudHMub3BlbkRldlRvb2xzKClcbiAgICB3aW5cbiAgICAgICAgXG4jIDAwMDAwMDAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICBcbiMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgIFxuIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAwMDAwMDAwICAgXG4jIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgICAgICBcbiMgMDAwMDAwMCAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuXG5kb25lID0gLT4gZWxlY3Ryb24ucmVtb3RlLmdldEN1cnJlbnRXaW5kb3coKS5oaWRlKClcblxuIyAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgIFxuIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuIyAwMDAwMDAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAwMDAgICAwMDAwMDAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIFxuIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuIyAwMDAgICAwMDAgICAwMDAwMDAwICAgICAwMDAgICAgIDAwMCAgICAgIDAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDAgIFxuXG5hY3RpdmVBcHAgPSBudWxsXG5hY3RpdmF0ZSA9IC0+XG4gICAgZG9uZSgpXG4gICAgaWYgYWN0aXZlQXBwLmlkXG4gICAgICAgIGlmIGFjdGl2ZUFwcC5pZCBpbiBbJ01haWwnICdDYWxlbmRhciddXG4gICAgICAgICAgICBpbmZvcyA9IHdjICdpbmZvJyAnQXBwbGljYXRpb25GcmFtZUhvc3QuZXhlJ1xuICAgICAgICAgICAgZm9yIGluZm8gaW4gaW5mb3NcbiAgICAgICAgICAgICAgICBpZiBpbmZvLnRpdGxlLmVuZHNXaXRoIGFjdGl2ZUFwcC5pZFxuICAgICAgICAgICAgICAgICAgICB3YyAnZm9jdXMnIGluZm8uaHduZFxuICAgICAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIGNoaWxkcC5zcGF3biAnc3RhcnQnLCBbe01haWw6J291dGxvb2ttYWlsOicgQ2FsZW5kYXI6J291dGxvb2tjYWw6J31bYWN0aXZlQXBwLmlkXV0sIGVuY29kaW5nOid1dGY4JyBzaGVsbDp0cnVlIGRldGFjaGVkOnRydWUgc3RkaW86J2luaGVyaXQnICAgICAgICAgICAgXG4gICAgICAgIGVsc2UgaWYgYWN0aXZlQXBwLmlkIGluIFsnQ2FsY3VsYXRvcicgJ1NldHRpbmdzJyAnTWljcm9zb2Z0IFN0b3JlJ11cbiAgICAgICAgICAgIGluZm9zID0gd2MgJ2luZm8nICdBcHBsaWNhdGlvbkZyYW1lSG9zdC5leGUnXG4gICAgICAgICAgICBmb3IgaW5mbyBpbiBpbmZvc1xuICAgICAgICAgICAgICAgIGlmIGluZm8udGl0bGUgPT0gYWN0aXZlQXBwLmlkXG4gICAgICAgICAgICAgICAgICAgIHdjICdmb2N1cycgaW5mby5od25kXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgY2hpbGRwLnNwYXduICdzdGFydCcsIFt7Q2FsY3VsYXRvcjonY2FsY3VsYXRvcjonIFNldHRpbmdzOidtcy1zZXR0aW5nczonICdNaWNyb3NvZnQgU3RvcmUnOidtcy13aW5kb3dzLXN0b3JlOid9W2FjdGl2ZUFwcC5pZF1dLCBlbmNvZGluZzondXRmOCcgc2hlbGw6dHJ1ZSBkZXRhY2hlZDp0cnVlIHN0ZGlvOidpbmhlcml0J1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB3YyAnZm9jdXMnIGFjdGl2ZUFwcC5pZCBcblxuIyAwMDAgICAwMDAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgXG4jIDAwMCAgIDAwMCAgMDAwICAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAwMDAgICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcbiMgMDAwMDAwMDAwICAwMDAgIDAwMCAgMDAwMCAgMDAwMDAwMDAwICAwMDAgICAgICAwMDAgIDAwMCAgMDAwMCAgMDAwMDAwMDAwICAgICAwMDAgICAgIFxuIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4jIDAwMCAgIDAwMCAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcblxuaGlnaGxpZ2h0ID0gKGUpIC0+XG4gICAgaWYgZS5pZFxuICAgICAgICBhY3RpdmVBcHA/LmNsYXNzTGlzdC5yZW1vdmUgJ2hpZ2hsaWdodCdcbiAgICAgICAgZS5jbGFzc0xpc3QuYWRkICdoaWdobGlnaHQnXG4gICAgICAgIGFjdGl2ZUFwcCA9IGVcblxubmV4dEFwcCA9IC0+IGhpZ2hsaWdodCBhY3RpdmVBcHAubmV4dFNpYmxpbmcgPyAkKCcuYXBwcycpLmZpcnN0Q2hpbGRcbnByZXZBcHAgPSAtPiBoaWdobGlnaHQgYWN0aXZlQXBwLnByZXZpb3VzU2libGluZyA/ICQoJy5hcHBzJykubGFzdENoaWxkXG5xdWl0QXBwID0gLT4ga2xvZyAncXVpdEFwcCcgYWN0aXZlQXBwLmlkXG4gICAgXG4jIDAwICAgICAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgXG4jIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgXG4jIDAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAwMDAwICAgXG4jIDAwMCAwIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAgXG4jIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgXG5cbm9uTW91c2VNb3ZlID0gKGV2ZW50KSAtPiBoaWdobGlnaHQgZXZlbnQudGFyZ2V0XG4gICAgXG5vbk1vdXNlRG93biA9IChldmVudCkgLT4gXG4gICAgYWN0aXZlQXBwID0gZXZlbnQudGFyZ2V0XG4gICAgYWN0aXZhdGUoKVxuICAgICAgICBcbiMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiMgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAwMDAgICBcbiMgMDAwMDAwMCAgICAwMDAwMDAwICAgICAwMDAwMCAgICBcbiMgMDAwICAwMDAgICAwMDAgICAgICAgICAgMDAwICAgICBcbiMgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgMDAwICAgICBcblxub25LZXlEb3duID0gKGV2ZW50KSAtPiBcbiAgICBcbiAgICB7IG1vZCwga2V5LCBjaGFyLCBjb21ibyB9ID0ga2V5aW5mby5mb3JFdmVudCBldmVudFxuICAgIFxuICAgIHN3aXRjaCBrZXlcbiAgICAgICAgd2hlbiAnZXNjJyAgIHRoZW4gZG9uZSgpXG4gICAgICAgIHdoZW4gJ3JpZ2h0JyB0aGVuIG5leHRBcHAoKVxuICAgICAgICB3aGVuICdsZWZ0JyAgdGhlbiBwcmV2QXBwKClcbiAgICAgICAgd2hlbiAncScgICAgIHRoZW4gcXVpdEFwcCgpXG4gICAgICAgIHdoZW4gJ2VudGVyJyAncmV0dXJuJyAnc3BhY2UnIHRoZW4gYWN0aXZhdGUoKVxuICAgICAgICBlbHNlIGtsb2cgJ29uS2V5RG93bicgY29tYm9cbiAgICAgICAgXG4gICAgc3dpdGNoIGNvbWJvXG4gICAgICAgIHdoZW4gJ2N0cmwrc2hpZnQrdGFiJyB0aGVuIHByZXZBcHAoKVxuICAgICAgICB3aGVuICdhbHQrY3RybCtxJyAgICAgdGhlbiBlbGVjdHJvbi5yZW1vdGUuYXBwLnF1aXQoKVxuICAgICAgICBcbm9uS2V5VXAgPSAoZXZlbnQpIC0+ICAgICAgICAgXG4gICAgXG4gICAgeyBtb2QsIGtleSwgY2hhciwgY29tYm8gfSA9IGtleWluZm8uZm9yRXZlbnQgZXZlbnRcbiAgICAjIGtsb2cgXCJ1cCAje21vZH0sICN7a2V5fSwgI3tjaGFyfSwgI3tjb21ib31cIlxuICAgIGlmIGVtcHR5IGNvbWJvXG4gICAgICAgIGFjdGl2YXRlKClcbiAgICAgICAgXG4jIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAwMDAwMCAgICAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICBcbiMgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgMDAwICAgICAgIDAwMCAwIDAwMCAgMDAwICAwMDAwICAwMDAgIFxuIyAwMDAgIDAwMCAwIDAwMCAgMDAwICAgICAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAgIDAwMCAwIDAwMCAgXG4jIDAwMCAgMDAwICAwMDAwICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgMDAwICAwMDAwICBcbiMgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgMDAwICAgICAgIDAwICAgICAwMCAgMDAwICAwMDAgICAwMDAgIFxuXG5pbml0V2luID0gLT5cbiAgICBcbiAgICB3aW4gPSBlbGVjdHJvbi5yZW1vdGUuZ2V0Q3VycmVudFdpbmRvdygpXG4gICAgXG4gICAgYSA9JCAnLmFwcHMnXG4gICAgXG4gICAgYS5vbm1vdXNlZG93biA9IG9uTW91c2VEb3duXG4gICAgYS5vbmtleWRvd24gICA9IG9uS2V5RG93blxuICAgIGEub25rZXl1cCAgICAgPSBvbktleVVwXG4gICAgXG4gICAgIyBpZiBub3Qgd2luLmRlYnVnXG4gICAgICAgICMgYS5vbmJsdXIgPSBkb25lXG4gICAgXG4gICAgbG9hZEFwcHMoKVxuICAgICAgICBcbiAgICBwb3N0Lm9uICduZXh0QXBwJyAtPiBcbiAgICAgICAgXG4gICAgICAgIGlmIHdpbi5pc1Zpc2libGUoKVxuICAgICAgICAgICAgbmV4dEFwcCgpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgIyBbeCx5XSA9IHdpbi5nZXRQb3NpdGlvbigpICAgICAjIGVuYWJsZSBzbW9vdGggZmFkZSBvbiB3aW5kb3dzOlxuICAgICAgICAgICAgd2luLnNldFBvc2l0aW9uIC0xMDAwMCwtMTAwMDAgIyBtb3ZlIHdpbmRvdyBvZmZzY3JlZW4gYmVmb3JlIHNob3dcbiAgICAgICAgICAgIHdpbi5zaG93KClcbiAgICAgICAgICAgICMgJCgnI21haW4nKS5jbGFzc0xpc3QucmVtb3ZlICdmYWRlJ1xuICAgICAgICAgICAgIyAkKCcjbWFpbicpLnN0eWxlLm9wYWNpdHkgPSAwXG4gICAgICAgICAgICBhID0kICcuYXBwcydcbiAgICAgICAgICAgIGEuaW5uZXJIVE1MID0gJydcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzdG9yZSA9IC0+IFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICMgaWYgeCA8IC0xMCBvciB5IDwgLTEwICMga2V5IHJlcGVhdCBoaWNrdXAgJ2ZpeCdcbiAgICAgICAgICAgICAgICAgICAgIyBiID0gd2luLmdldEJvdW5kcygpXG4gICAgICAgICAgICAgICAgICAgICMgeCA9IChzY3JlZW5TaXplKCkud2lkdGggLSBiLndpZHRoKS8yXG4gICAgICAgICAgICAgICAgICAgICMgeSA9IDBcbiAgICAgICAgICAgICAgICAjIGVsc2VcbiAgICAgICAgICAgICAgICB3ciA9IHdpblJlY3QgYXBwcy5sZW5ndGhcbiAgICAgICAgICAgICAgICB3aW4uc2V0Qm91bmRzIHdyXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICMgJCgnI21haW4nKS5jbGFzc0xpc3QuYWRkICdmYWRlJ1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgc2V0VGltZW91dCByZXN0b3JlLCAzMCAjIGdpdmUgd2luZG93cyBzb21lIHRpbWUgdG8gZG8gaXQncyBmbGlja2VyaW5nXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGxvYWRBcHBzKClcbiAgICBcbiMgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgICAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwMCAgICAwMDAwMDAwICBcbiMgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiMgMDAwICAgICAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAgICBcbiMgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAgICAgICAgICAgICAgMDAwICBcbiMgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAgICAgICAgIDAwMDAwMDAgICBcblxubG9hZEFwcHMgPSAtPlxuICAgIFxuICAgIGEgPSQgJy5hcHBzJ1xuICAgIGEuaW5uZXJIVE1MID0gJydcbiAgICBcbiAgICBmb3IgcCBpbiBnZXRBcHBzKClcbiAgICAgICAgYS5hcHBlbmRDaGlsZCBlbGVtICdpbWcnLFxuICAgICAgICAgICAgaWQ6IHBcbiAgICAgICAgICAgIGNsYXNzOidhcHAnIFxuICAgICAgICAgICAgc3JjOnNsYXNoLmZpbGVVcmwgcG5nUGF0aCBwXG4gICAgICAgIFxuICAgIGEuZm9jdXMoKVxuICAgIFxuICAgIGhpZ2hsaWdodCBhLmZpcnN0Q2hpbGQubmV4dFNpYmxpbmcgPyBhLmZpcnN0Q2hpbGRcbiAgICAgICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBcbiAgICBzdGFydDpzdGFydFxuICAgIGluaXRXaW46aW5pdFdpblxuICAgIFxuICAgIFxuICAgICJdfQ==
//# sourceURL=../coffee/switch.coffee